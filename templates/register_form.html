<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register</title>
</head>
<body>
<a href={{ url_for('index') }}>Back to index</a>
<form id="registerForm" method="post" action="{{ url_for('api.create_user') }}"
      data-redirect-url="{{ url_for("index") }}">
    <p>Enter username:</p>
    <p><input type="text" name="username" id="username"></p>
    <p>Enter email:</p>
    <p><input type="text" name="email" id="email"></p>
    <p>Enter password:</p>
    <p>
        <input type="password" name="password" id="password">
        <button type="button" id="togglePassword">Show/Hide</button>
    </p>
    <p><input type="submit" value="submit"></p>
    <script type="module">
        import {registerUser} from "../static/jsAPICalls.js";
        import {togglePassword, setFlaskSessionUsername} from "../static/functions.js";

        document.getElementById("togglePassword").addEventListener("click", togglePassword);


        async function callRegisterUser() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            const email = document.getElementById("email").value;
            const registrationData = await registerUser(username, email, password);
            if (!registrationData.error) {
                // Data is available, you can use registrationData
                await setFlaskSessionUsername(username);
            } else {
                // Handle the error
                console.error('Registration error:', registrationData.error);
            }
        }

        document.getElementById("registerForm").addEventListener("submit", async function (event) {
            event.preventDefault();
            await callRegisterUser();
            window.location.href = this.getAttribute("data-redirect-url");
        });
    </script>
</form>
</body>
</html>